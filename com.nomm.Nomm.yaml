id: com.nomm.Nomm
runtime: org.gnome.Platform
runtime-version: '49' # Matching the latest stable GNOME runtime
sdk: org.gnome.Sdk
command: nomm # The name of your entry-point script
finish-args:
  # Network access for downloading images and Nexus mods
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  # Access to Steam and Heroic configurations
  - --filesystem=home:ro
  # Specific permission for Heroic's Flatpak config if Heroic is also a Flatpak
  - --filesystem=~/.var/app/com.heroicgameslauncher.hgl/config/heroic:ro
  - --filesystem=xdg-run/app/com.heroicgameslauncher.hgl:ro
  - --own-name=com.nomm.Nomm
  # Access to Steam
  # Standard Steam path
  - --filesystem=~/.local/share/Steam:ro
  # Flatpak Steam path (if the user is running Steam as a Flatpak)
  - --filesystem=~/.var/app/com.valvesoftware.Steam:ro
  - --filesystem=xdg-run/app/com.valvesoftware.Steam:ro
  # mounting points
  - --filesystem=/run/media:rw
  - --filesystem=/mnt:rw

modules:
  # 1. Python dependencies (generated via flatpak-pip-generator)
  - python3-modules.json

  # 2. Your Application
  - name: nomm
    buildsystem: simple

    build-commands:
      # Install entry point from the src folder to /app/bin
      - install -D src/launcher.py /app/bin/nomm
      
      # Install desktop file
      - install -D com.nomm.Nomm.desktop /app/share/applications/com.nomm.Nomm.desktop

      # Install metainfo
      - install -D com.nomm.Nomm.metainfo.xml /app/share/metainfo/com.nomm.Nomm.metainfo.xml

      # Install icon
      - install -D assets/nomm.png /app/share/icons/hicolor/64x64/apps/com.nomm.Nomm.png

      # Copy all other python files FROM src into the same /app/bin folder
      # This ensures 'nomm' and 'dashboard.py' are flat neighbors
      - cp src/*.py /app/bin/
      - cp src/*.yaml /app/bin/
      - cp src/*.css /app/bin/
      
      # Copy your non-code folders
      - cp -r assets /app/bin/assets
      - cp -r default_game_configs /app/bin/default_game_configs
    sources:
      - type: dir
        path: .